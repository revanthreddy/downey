<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
	<head>
		<title>cube initialize</title>
		<style>canvas { width: 100%; height: 100% }</style>
	</head>
	<body>
                <!--<button onclick="toggleRotation();">Start/Stop</button>-->
		<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
		<script src="js/Tween.js"></script>
                
		<script>
                var startTime	= Date.now();
                var container;
                var camera, scene, renderer, stats;
                var cube;
                    // maybe replace that by window... or something
                var userOpts	= {
                        range		: 800,
                        duration	: 1000,
                        delay		: 200,
                        easing		: 'Elastic.EaseInOut'
                };
                
                // ## bootstrap functions
                // initialiaze everything
                init();
                // make it move			
                animate();
                
                function setupTween()
                {
                        // 
                        var update	= function(){
                                cube.position.x += 0.2;
                        }
                        var current	= { x: -userOpts.range };

                        // remove previous tweens if needed
                        TWEEN.removeAll();

                        // convert the string from dat-gui into tween.js functions 
                        var easing	= TWEEN.Easing[userOpts.easing.split('.')[0]][userOpts.easing.split('.')[1]];
                        // build the tween to go ahead
                        var tweenHead	= new TWEEN.Tween({x : 0.1})
                                .to({x: 0.3}, userOpts.duration)
                                .delay(userOpts.delay)
                                .easing(easing)
                                .onUpdate(update);
                        // build the tween to go backward
//                        var tweenBack	= new TWEEN.Tween(current)
//                                .to({x: -userOpts.range}, userOpts.duration)
//                                .delay(userOpts.delay)
//                                .easing(easing)
//                                .onUpdate(update);

                        // after tweenHead do tweenBack
                        //tweenHead.chain(tweenBack);
                        // after tweenBack do tweenHead, so it is cycling
                        //tweenBack.chain(tweenHead);

                        // start the first
                        tweenHead.start();
                }
                function buildGui(options, callback)
                {
                        // collect all available easing in TWEEN library
                        var easings	= {};
                        Object.keys(TWEEN.Easing).forEach(function(family){
                                Object.keys(TWEEN.Easing[family]).forEach(function(direction){
                                        var name	= family+'.'+direction;
                                        easings[name]	= name;
                                });
                        });
                        // the callback notified on UI change
                        var change	= function(){
                                callback(options)
                        }
                       
                }
                
                function init(){
			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(100, window.innerWidth/window.innerHeight, 0.1, 1000);

			renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

                         // build the GUI 
                        buildGui(userOpts, function(){
                                console.log("userOpts", userOpts)
                                setupTween();
                        });

                        // initial setup of the tweens
                        setupTween();
//			var geometry = new THREE.CubeGeometry(2,2,1);
//			var material = new THREE.MeshBasicMaterial({color: 0x00ff00});
                        var geometry = new THREE.CubeGeometry( 2, 2, 1 );
                        for ( var i = 0; i < geometry.faces.length; i ++ ) {
                            geometry.faces[ i ].color.setHex( Math.random() * 0xffffff );
                        }

                        var material = new THREE.MeshBasicMaterial( { color: 0xffffff, vertexColors: THREE.FaceColors } );
                        
			cube = new THREE.Mesh(geometry, material);
                        cube.geometry.dynamic =true;
                        
                        cube.position.x = 0.8;
			scene.add(cube);
                        
			camera.position.z = 8;
                }
                        // ## Animate and Display the Scene
                function animate() {
                        // render the 3D scene
                        render();
                        // relaunch the 'timer' 
                        requestAnimationFrame( animate );
//                        cube.rotation.x += 0.05;
//                        cube.rotation.y += 0.005;
                        // update the tweens from TWEEN library
                        TWEEN.update();
                }


                // ## Render the 3D Scene
                function render() {
                        // actually display the scene in the Dom element
                        renderer.render( scene, camera );
                }

                        
                        
		</script>
                
                
                
	</body>
</html>
